<!DOCTYPE HTML>
<html lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
        <title>LevelUp API Documentation - Submit Transaction</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.css" media="screen">
	<link rel="icon" 
	      type="image/png" 
	      href="../favicon.ico">
    <!-- you don't need to keep this, but it's cool for stats! -->
    <!-- Le styles -->
    <link href="/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 20px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
    </style>
    <link href="/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://twitter.github.com/bootstrap/assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://twitter.github.com/bootstrap/assets/ico/apple-touch-icon-114-precomposed.png">
      <link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://twitter.github.com/bootstrap/assets/ico/apple-touch-icon-72-precomposed.png">
                    <link rel="apple-touch-icon-precomposed" href="http://twitter.github.com/bootstrap/assets/ico/apple-touch-icon-57-precomposed.png">
                                   <link rel="shortcut icon" href="../img/favicon.ico">  
								<link type="text/css" rel="stylesheet" href="/css/hellobar.css" />
<script type="text/javascript" src="/js2/hellobar.js"></script>
<script language="JavaScript" type="text/javascript">
function Tog(x) {
var expandable = document.getElementById('expandable');
expandable.style.display = x;
}
</script>
<script language="JavaScript" type="text/javascript">
function Tog(x) {
var expandable = document.getElementById('expandable2');
expandable.style.display = x;
}
</script>
<!--jQuery References-->
<script src="http://code.jquery.com/jquery-1.8.2.min.js" type="text/javascript"></script>
<script src="http://code.jquery.com/ui/1.9.1/jquery-ui.min.js" type="text/javascript"></script>
 
<!--Theme-->
<link href="http://cdn.wijmo.com/themes/rocket/jquery-wijmo.css" rel="stylesheet" type="text/css" title="rocket-jqueryui" />
 
<!--Wijmo Widgets CSS-->
<link href="http://cdn.wijmo.com/jquery.wijmo-complete.all.2.3.5.min.css" rel="stylesheet" type="text/css" />
 
<!--Wijmo Widgets JavaScript-->
<script src="http://cdn.wijmo.com/jquery.wijmo-open.all.2.3.5.min.js" type="text/javascript"></script>
<script src="http://cdn.wijmo.com/jquery.wijmo-complete.all.2.3.5.min.js" type="text/javascript"></script>
<style type="text/css">
    #expander1
    {
        width: 550px;
    }
</style>
<script id="scriptInit" type="text/javascript">
    $(document).ready(function () { 
        $("#expander1").wijexpander({ 
            contentUrl: "http://www.msdn.com",
            expandDirection: "top"
        });
    });
</script>
</head>
  <body>
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span3">
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              <li class="nav-header">LevelUp API Overview</li>
              <li><a href="../index.html">What is LevelUp?</a></li>
              <li><a href="/use_cases/index.html">Developer Use Cases</a></li>
              <li><a href="/dev_support/index.html">Developer Support</a></li>
              <li class="nav-header">Full API Documentation</li>
              <li><a href="/endpoints/index.html">Endpoints</a></li>
              <li class="nav-header">Transaction Flow</li>
              <li><a href="/transaction_flow/index.html">Transaction Flow</a></li>
              <li class="nav-header">Customer Data APIs</li>
              <li><a href="/customer_data/index.html">Customer Data APIs</a></li>
              <li class="nav-header">POS Integration</li>
              <li><a href="/integration_overview/index.html">Overview</a></li>
              <li><a href="/integration_1/index.html">Step 1 - Authentication</a></li>
              <li><a href="/integration_2/index.html">Step 2 - Orders & Refunds</a></li>
              <li><a href="/integration_3/index.html">Step 3 - Analytics and Testing</a></li>
              <li><a href="/dodont/index.html">Do's and Dont's</a></li>
              <li><a href="/scanner/index.html">LevelUp Scanner</a></li>
              <li><a href="/orders/index.html">Order Process</a></li>
              <li><a href="/integration_apis/index.html">Selected POS Integration APIs</a></li>
              <li class="nav-header">White Label App</li>
              <li><a href="/whitelabel_overview/index.html">Overview</a></li>
              <li><a href="/whitelabel_sdk_features/index.html">Features in SDK</a></li>
              <li><a href="/whitelabel_sample_app/index.html">Features in Sample App</a></li>
              <li class="nav-header">Connected Apps</li>
              <li><a href="/web_overview/index.html">Overview</a></li>
              <li class="nav-header">Browsing Places</li>
              <li><a href="/browsing_overview/index.html">Overview</a></li>
              <li><a href="/browsing_1/index.html">Step 1 - Listing Divisions</a></li>
              <li><a href="/browsing_2/index.html">Step 2 - Listing Merchants</a></li>
              <li><a href="/browsing_3/index.html">Step 3 - Listing Locations</a></li>
              <li><a href="/browsing_4/index.html">Selected Browsing APIs</a></li>



                          </ul>
          </div><!--/.well -->
        </div><!--/span-->
        <div class="span9">
          <div class="hero-unit">
    <h2 id="step-4---complete-transaction">Step 4 - Complete Transaction</h2>

<p>When the form is submitted, use the LevelUp API to submit a transaction.</p>

<p>To do this, you will need to get OAuth2 password token authentication working, as documented in the Transaction API documentation. You will also need to ask your OAuth2 library for a copy of your session token, and convert to a string. (Ruby sample code is available below. Unfortunately, the details of this step are highly specific to your environment and OAuth2 library.)</p>

<p>Once that is done, POST a new transction as follows:</p>

<p>URL: https://api.thelevelup.com/v13/merchants/<code>MERCHANT_ID</code>/orders.json</p>

<p>Authentication: This call must be made through your OAuth2 library once you&#8217;re authenticated.</p>

<h2 id="params">Params:</h2>
<p><code>order[qr_code_data]</code>: The QR code data from the hidden &#8220;levelup_code&#8221; &lt;input&gt; element in your form.</p>

<p><code>order[spend]</code>: A string of the form &#8220;15.99&#8221;, representing the purchase price in dollars.</p>

<p><code>access_token</code>: A copy of OAuth2 access token from your OAuth2 library, passed as string.</p>

<p>Sample Code (in Ruby, using the popular oauth2 gem)</p>

<pre><code>API_URL = 'https://api.thelevelup.com/v13'

def create
	# Authorize with the server using OAuth2.
	client = OAuth2::Client.new(LEVELUP_CLIENT_ID, '',
                            	token_url: '/oauth/access_token', site: API_URL)
	token = client.password.get_token(`LEVELUP_MERCHANT_USER`,
                                  `LEVELUP_MERCHANT_PASSWORD`)

# Place the order.
spend = '0.05'
qr_code = params[:levelup_code]
levelup_params = {
  'order[qr_code_data]' =&gt; qr_code,
  'order[spend]' =&gt; spend,
  # We need to pass the access token again here.
  'access_token' =&gt; token.token.to_s
}
response = token.post("/merchants/#{LEVELUP_MERCHANT_ID}/orders.json",
                      params: levelup_params)

# Record the order in the database.
order = response.parsed['order']
Order.create!(spend: spend, levelup_order_id: order['id'])

# Show the thank you page.
redirect_to action: 'thanks'   rescue OAuth2::Error =&gt; e
# Display an error to the user.
flash[:oauth_error] = "Error: #{e.code}"
redirect_to action: 'oops'   end
</code></pre>

<p>And that should be it! Now your customers can pay with their phones and enjoy all the benefits of LevelUp&#8230; on the web!</p>


            </div><!--/span-->
          </div><!--/row-->
        </div><!--/span-->
      </div><!--/row-->

      <hr>

      <footer>
        <p>Â© LevelUp 2012</p>
      </footer>

    </div><!--/.fluid-container-->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/js2/jquery.js"></script>
    <script src="/js2/bootstrap-transition.js"></script>
    <script src="/js2/bootstrap-alert.js"></script>
    <script src="/js2/bootstrap-modal.js"></script>
    <script src="/js2/bootstrap-dropdown.js"></script>
    <script src="/js2/bootstrap-scrollspy.js"></script>
    <script src="/js2/bootstrap-tab.js"></script>
    <script src="/js2/bootstrap-tooltip.js"></script>
    <script src="/js2/bootstrap-popover.js"></script>
    <script src="/js2/bootstrap-button.js"></script>
    <script src="/js2/bootstrap-collapse.js"></script>
    <script src="/js2/bootstrap-carousel.js"></script>
    <script src="/js2/bootstrap-typeahead.js"></script>
	<script type="text/javascript">
	    new HelloBar( "Welcome to the LevelUp API Documentation Site! -- Questions? Email <a href=mailto:pos@thelevelup.com>pos@thelevelup.com</a>", {
		showWait: 500,
		positioning: 'sticky',
		transition: 'bouncy',
		wiggleWait: 500,
		shadow: true,
		speed: 1000,
		texture: 'diagonal',
		tabSide: 'left',
		helloBarLogo: false,
		fontWeight: '500',
		}, 3.9 );
	</script>
  

</body></html>




